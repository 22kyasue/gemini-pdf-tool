# #004 â€” Heading "Blowup" and Bracketing Request

**Date:** 2026-02-21  
**Files affected:** `src/components/ContentRenderer.tsx`, `src/index.css`

---

## Symptom

Despite previous sanitization, some headings generated by Gemini (especially those following labels like "Plaintext") were still rendering too large ("blowing up") and disrupting the PDF layout. The user requested that `#` heading markers be bracketed (e.g., `[#]`) to de-emphasize them and reduce their impact.

---

## Root Cause

1.  **Semantic Ambiguity:** Gemini often uses markdown headings (`#`, `##`, etc.) as part of descriptions or category labels rather than actual document sections.
2.  **CSS Scale:** The default CSS heading sizes (H1=2rem, H2=1.4rem) were slightly too large for compact PDF archival documents, making even legitimate headings feel overwhelming.

---

## Fix

### 1. Heading Bracketing in Sanitizer
Updated `sanitizeContent` in `ContentRenderer.tsx` to transform all markdown headings into bracketed literal text. This effectively prevents `react-markdown` from treating them as structural headers, defaulting them to normal text size and removing implicit bolding/borders.

```tsx
function sanitizeContent(md: string): string {
    let sanitized = md;
    
    // 1. Bracket all markdown headings (e.g., "# " -> "[#] ", "## " -> "[##] ").
    // Prevents "blowup" by making them literal text instead of structural headers.
    sanitized = sanitized.replace(/^([ \t]*)(#{1,6})( )/gm, '$1[$2]$3');

    // ... other sanitizations ...
    return sanitized;
}
```

### 2. CSS Size Reduction
Reduced the font sizes of H1, H2, and H3 in `index.css` to ensure better proportionality for PDF documents and refined the H1 border style.

```css
.markdown-body h1 {
  font-size: 1.6rem;
  border-bottom: 1.5px solid var(--color-primary-500);
}
.markdown-body h2 {
  font-size: 1.2rem;
}
.markdown-body h3 {
  font-size: 1.05rem;
}
```

---

## Prevention Rule

> **Continuously evaluate visual hierarchy in PDF exports.**
> 
> AI-generated content often breaks traditional document structures. When content feels "blown up" or disproportionate, use sanitization to transform structural markers into literal text (bracketing) and keep CSS header scales conservative.
